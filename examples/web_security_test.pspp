# PSP ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ ë³´ì•ˆ í…ŒìŠ¤íŠ¸ ì˜ˆì œ
# PowerShell + Cì–¸ì–´ + Python í•˜ì´ë¸Œë¦¬ë“œ ë¬¸ë²•

Write-Host "ğŸŒ PSP ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ ë³´ì•ˆ í…ŒìŠ¤íŠ¸" -ForegroundColor Cyan

# Cì–¸ì–´ ìŠ¤íƒ€ì¼ êµ¬ì¡°ì²´ ì •ì˜
struct WebTarget {
    string $Url;
    string $Method;
    hashtable $Headers;
    hashtable $Parameters;
}

# ëŒ€ìƒ ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ ì„¤ì •
string $baseUrl = "http://testphp.vulnweb.com"
array $testUrls = @(
    "$baseUrl/artists.php",
    "$baseUrl/search.php", 
    "$baseUrl/login.php",
    "$baseUrl/comment.php"
)

Write-Output "ëŒ€ìƒ ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜: $baseUrl"
Write-Output "í…ŒìŠ¤íŠ¸ URL ìˆ˜: $($testUrls.Count)"

# 1. ê¸°ë³¸ ì›¹ ì„œë²„ ì •ë³´ ìˆ˜ì§‘
Write-Host "`n1. ì›¹ ì„œë²„ ì •ë³´ ìˆ˜ì§‘" -ForegroundColor Yellow

hashtable $serverInfo = Test-NetConnection $baseUrl.Replace("http://", "").Replace("https://", "") -Port 80

if ($serverInfo.TcpTestSucceeded) {
    Write-Host "âœ“ ì›¹ ì„œë²„ ì—°ê²° ì„±ê³µ" -ForegroundColor Green
    
    # HTTP í—¤ë” ë¶„ì„ ì‹œë®¬ë ˆì´ì…˜
    hashtable $headers = @{
        Server = "Apache/2.2.22"
        "X-Powered-By" = "PHP/5.3.10"
        "Content-Type" = "text/html"
    }
    
    Write-Output "ì„œë²„ ì •ë³´:"
    $headers.GetEnumerator() | ForEach-Object {
        Write-Output "  $($_.Key): $($_.Value)"
    }
} else {
    Write-Host "âœ— ì›¹ ì„œë²„ ì—°ê²° ì‹¤íŒ¨" -ForegroundColor Red
}

# 2. ë””ë ‰í† ë¦¬ ë° íŒŒì¼ ì—´ê±°
Write-Host "`n2. ë””ë ‰í† ë¦¬ ë° íŒŒì¼ íƒìƒ‰" -ForegroundColor Yellow

array $commonDirs = @("admin", "backup", "config", "test", "tmp", "uploads", "images", "css", "js")
array $foundDirs = @()

Write-Output "ì¼ë°˜ì ì¸ ë””ë ‰í† ë¦¬ í™•ì¸ ì¤‘..."

$commonDirs | ForEach-Object {
    string $dir = $_
    string $testUrl = "$baseUrl/$dir"
    
    # HTTP ìƒíƒœ ì½”ë“œ ì‹œë®¬ë ˆì´ì…˜
    int $statusCode = Get-Random -Minimum 200 -Maximum 500
    
    if ($statusCode -eq 200 -or $statusCode -eq 403) {
        $foundDirs += $dir
        string $status = if ($statusCode -eq 200) { "ì ‘ê·¼ ê°€ëŠ¥" } else { "ì ‘ê·¼ ê¸ˆì§€" }
        Write-Host "  âœ“ /$dir - $status (HTTP $statusCode)" -ForegroundColor Green
    }
}

Write-Output "ë°œê²¬ëœ ë””ë ‰í† ë¦¬: $($foundDirs.Count)ê°œ"

# 3. SQL ì¸ì ì…˜ í…ŒìŠ¤íŠ¸
Write-Host "`n3. SQL ì¸ì ì…˜ ì·¨ì•½ì  í…ŒìŠ¤íŠ¸" -ForegroundColor Yellow

array $sqlPayloads = @(
    "'",
    "' OR '1'='1",
    "' OR 1=1 --",
    "'; DROP TABLE users; --",
    "' UNION SELECT NULL, username, password FROM users --"
)

array $vulnerableUrls = @()

$testUrls | ForEach-Object {
    string $url = $_
    Write-Output "í…ŒìŠ¤íŠ¸ ì¤‘: $url"
    
    $sqlPayloads | ForEach-Object {
        string $payload = $_
        
        # SQL ì¸ì ì…˜ í…ŒìŠ¤íŠ¸ ì‹¤í–‰
        hashtable $result = Test-SQLInjection -Url $url -Parameter "id" -Payload $payload
        
        if ($result.Vulnerable) {
            $vulnerableUrls += @{
                Url = $url
                Parameter = "id"
                Payload = $payload
                Response = $result.Response
            }
            Write-Host "  âš ï¸  SQL ì¸ì ì…˜ ì·¨ì•½ì  ë°œê²¬!" -ForegroundColor Red
            Write-Output "     í˜ì´ë¡œë“œ: $payload"
        }
    }
}

if ($vulnerableUrls.Count -eq 0) {
    Write-Host "  âœ“ SQL ì¸ì ì…˜ ì·¨ì•½ì  ì—†ìŒ" -ForegroundColor Green
}

# 4. XSS (Cross-Site Scripting) í…ŒìŠ¤íŠ¸
Write-Host "`n4. XSS ì·¨ì•½ì  í…ŒìŠ¤íŠ¸" -ForegroundColor Yellow

array $xssPayloads = @(
    "<script>alert('XSS')</script>",
    "<img src=x onerror=alert('XSS')>",
    "javascript:alert('XSS')",
    "<svg onload=alert('XSS')>",
    "'><script>alert('XSS')</script>"
)

array $xssVulnerable = @()

Write-Output "XSS í˜ì´ë¡œë“œ í…ŒìŠ¤íŠ¸ ì¤‘..."

$testUrls | ForEach-Object {
    string $url = $_
    
    $xssPayloads | ForEach-Object {
        string $payload = $_
        
        # XSS í…ŒìŠ¤íŠ¸ ì‹œë®¬ë ˆì´ì…˜
        bool $isVulnerable = (Get-Random -Minimum 0 -Maximum 10) -lt 3  # 30% í™•ë¥ 
        
        if ($isVulnerable) {
            $xssVulnerable += @{
                Url = $url
                Payload = $payload
                Type = "Reflected XSS"
            }
            Write-Host "  âš ï¸  XSS ì·¨ì•½ì  ë°œê²¬: $url" -ForegroundColor Red
            Write-Output "     í˜ì´ë¡œë“œ: $payload"
        }
    }
}

if ($xssVulnerable.Count -eq 0) {
    Write-Host "  âœ“ XSS ì·¨ì•½ì  ì—†ìŒ" -ForegroundColor Green
}

# 5. ì¸ì¦ ìš°íšŒ í…ŒìŠ¤íŠ¸
Write-Host "`n5. ì¸ì¦ ìš°íšŒ í…ŒìŠ¤íŠ¸" -ForegroundColor Yellow

array $authBypassPayloads = @(
    "admin' --",
    "admin' #",
    "admin'/*",
    "' or 1=1#",
    "' or 1=1--"
)

string $loginUrl = "$baseUrl/login.php"
Write-Output "ë¡œê·¸ì¸ í˜ì´ì§€ í…ŒìŠ¤íŠ¸: $loginUrl"

$authBypassPayloads | ForEach-Object {
    string $payload = $_
    Write-Output "ì¸ì¦ ìš°íšŒ ì‹œë„: username=$payload, password=test"
    
    # ì¸ì¦ ìš°íšŒ ì‹œë®¬ë ˆì´ì…˜
    bool $bypassed = (Get-Random -Minimum 0 -Maximum 10) -lt 2  # 20% í™•ë¥ 
    
    if ($bypassed) {
        Write-Host "  âš ï¸  ì¸ì¦ ìš°íšŒ ì„±ê³µ!" -ForegroundColor Red
        Write-Output "     í˜ì´ë¡œë“œ: $payload"
    }
}

# 6. íŒŒì¼ ì—…ë¡œë“œ ì·¨ì•½ì  í…ŒìŠ¤íŠ¸
Write-Host "`n6. íŒŒì¼ ì—…ë¡œë“œ ì·¨ì•½ì  í…ŒìŠ¤íŠ¸" -ForegroundColor Yellow

array $maliciousFiles = @(
    "shell.php",
    "backdoor.jsp", 
    "webshell.aspx",
    "reverse.exe"
)

Write-Output "ì•…ì„± íŒŒì¼ ì—…ë¡œë“œ í…ŒìŠ¤íŠ¸..."

$maliciousFiles | ForEach-Object {
    string $filename = $_
    Write-Output "íŒŒì¼ ì—…ë¡œë“œ ì‹œë„: $filename"
    
    # ì—…ë¡œë“œ í…ŒìŠ¤íŠ¸ ì‹œë®¬ë ˆì´ì…˜
    bool $uploaded = (Get-Random -Minimum 0 -Maximum 10) -lt 1  # 10% í™•ë¥ 
    
    if ($uploaded) {
        Write-Host "  âš ï¸  ì•…ì„± íŒŒì¼ ì—…ë¡œë“œ ì„±ê³µ: $filename" -ForegroundColor Red
    } else {
        Write-Host "  âœ“ íŒŒì¼ ì—…ë¡œë“œ ì°¨ë‹¨ë¨: $filename" -ForegroundColor Green
    }
}

# 7. ë³´ì•ˆ í—¤ë” ê²€ì‚¬
Write-Host "`n7. ë³´ì•ˆ í—¤ë” ê²€ì‚¬" -ForegroundColor Yellow

hashtable $securityHeaders = @{
    "X-Frame-Options" = $false
    "X-XSS-Protection" = $false
    "X-Content-Type-Options" = $false
    "Strict-Transport-Security" = $false
    "Content-Security-Policy" = $false
}

Write-Output "ë³´ì•ˆ í—¤ë” í™•ì¸ ì¤‘..."

$securityHeaders.GetEnumerator() | ForEach-Object {
    string $header = $_.Key
    bool $present = $_.Value
    
    if ($present) {
        Write-Host "  âœ“ $header: ì„¤ì •ë¨" -ForegroundColor Green
    } else {
        Write-Host "  âœ— $header: ëˆ„ë½" -ForegroundColor Red
    }
}

# 8. ì¢…í•© ë³´ê³ ì„œ ìƒì„±
Write-Host "`n8. ë³´ì•ˆ í…ŒìŠ¤íŠ¸ ë³´ê³ ì„œ" -ForegroundColor Yellow

hashtable $finalReport = @{
    Target = $baseUrl
    TestTime = Get-Date
    TestedUrls = $testUrls.Count
    SQLInjections = $vulnerableUrls.Count
    XSSVulnerabilities = $xssVulnerable.Count
    SecurityScore = 0
}

# ë³´ì•ˆ ì ìˆ˜ ê³„ì‚°
int $maxScore = 100
int $deductions = 0

$deductions += $vulnerableUrls.Count * 20      # SQL ì¸ì ì…˜ -20ì 
$deductions += $xssVulnerable.Count * 15       # XSS -15ì 
$deductions += ($securityHeaders.Values | Where-Object { $_ -eq $false }).Count * 5  # ë³´ì•ˆí—¤ë” -5ì 

$finalReport.SecurityScore = [Math]::Max(0, $maxScore - $deductions)

Write-Output "`n=== ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ ë³´ì•ˆ í…ŒìŠ¤íŠ¸ ë³´ê³ ì„œ ==="
Write-Output "ëŒ€ìƒ: $($finalReport.Target)"
Write-Output "í…ŒìŠ¤íŠ¸ ì‹œê°„: $($finalReport.TestTime)"
Write-Output "í…ŒìŠ¤íŠ¸ëœ URL: $($finalReport.TestedUrls)ê°œ"
Write-Output ""

Write-Output "ë°œê²¬ëœ ì·¨ì•½ì :"
Write-Host "  SQL ì¸ì ì…˜: $($finalReport.SQLInjections)ê±´" -ForegroundColor $(if ($finalReport.SQLInjections -gt 0) { "Red" } else { "Green" })
Write-Host "  XSS: $($finalReport.XSSVulnerabilities)ê±´" -ForegroundColor $(if ($finalReport.XSSVulnerabilities -gt 0) { "Red" } else { "Green" })

Write-Output ""
string $scoreColor = if ($finalReport.SecurityScore -ge 80) { "Green" } elseif ($finalReport.SecurityScore -ge 60) { "Yellow" } else { "Red" }
Write-Host "ë³´ì•ˆ ì ìˆ˜: $($finalReport.SecurityScore)/100" -ForegroundColor $scoreColor

Write-Output "`nê¶Œì¥ì‚¬í•­:"
if ($vulnerableUrls.Count -gt 0) {
    Write-Output "  â€¢ SQL ì¸ì ì…˜ ë°©ì§€ë¥¼ ìœ„í•œ íŒŒë¼ë¯¸í„°í™”ëœ ì¿¼ë¦¬ ì‚¬ìš©"
}
if ($xssVulnerable.Count -gt 0) {
    Write-Output "  â€¢ XSS ë°©ì§€ë¥¼ ìœ„í•œ ì…ë ¥ ê²€ì¦ ë° ì¶œë ¥ ì¸ì½”ë”©"
}
Write-Output "  â€¢ ë³´ì•ˆ í—¤ë” ì„¤ì • (X-Frame-Options, CSP ë“±)"
Write-Output "  â€¢ ì •ê¸°ì ì¸ ë³´ì•ˆ í…ŒìŠ¤íŠ¸ ìˆ˜í–‰"
Write-Output "  â€¢ ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ ë°©í™”ë²½(WAF) ë„ì… ê²€í† "

Write-Host "`nâœ… PSP ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ ë³´ì•ˆ í…ŒìŠ¤íŠ¸ ì™„ë£Œ" -ForegroundColor Green
